<script>
document.getElementById("preorderForm").addEventListener("submit", async (event) => {
  event.preventDefault();

  const name = document.getElementById("name").value;
  const email = document.getElementById("email").value;
  const quantity = document.getElementById("quantity").value;
  const comments = document.getElementById("comments").value;

  const loadingMessage = document.getElementById("loading-message");
  const successMessage = document.getElementById("success-message");

  loadingMessage.classList.remove("hidden-message");

  try {
    const response = await fetch("https://wwrg1xdnr2.execute-api.us-west-1.amazonaws.com/live/create-checkout-session", {
      method: "POST",
      headers: { 
        "Content-Type": "application/json",
        "Access-Control-Allow-Origin": "*" // Temporary fix (CORS should be handled in AWS)
      },
      body: JSON.stringify({ name, email, quantity, comments }),
    });

    if (!response.ok) {
      throw new Error(`HTTP error! Status: ${response.status}`);
    }

    const data = await response.json();
    loadingMessage.classList.add("hidden-message");

    if (data.url) {
      successMessage.classList.remove("hidden-message");
      window.location.href = data.url; // Redirect to Stripe Checkout
    } else {
      alert("Error: No checkout URL received!");
    }
  } catch (error) {
    console.error("API Error:", error);
    alert("Failed to process order. Please try again later.");
    loadingMessage.classList.add("hidden-message");
  }
});
</script>
